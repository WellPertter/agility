unit untGrid;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf,
  FireDAC.DApt.Intf, FireDAC.Stan.Async, FireDAC.DApt, Data.DB, Vcl.Grids,
  Vcl.DBGrids, FireDAC.Comp.DataSet, FireDAC.Comp.Client, System.ImageList,
  Vcl.ImgList;

type
  TformGrid = class(TForm)
    QryItens: TFDQuery;
    dsItens: TDataSource;
    DBGrid: TDBGrid;
    QryItensid: TFDAutoIncField;
    QryItensdescricao: TStringField;
    QryItenstipo: TStringField;
    QryItensSelected: TBooleanField;
    imageGridSelected: TImageList;
    procedure FormShow(Sender: TObject);
    procedure DBGridDrawColumnCell(Sender: TObject; const Rect: TRect;
      DataCol: Integer; Column: TColumn; State: TGridDrawState);
    procedure DBGridCellClick(Column: TColumn);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  formGrid: TformGrid;




implementation


uses untDMmain;

{$R *.dfm}

procedure TformGrid.DBGridCellClick(Column: TColumn);
begin
  if DBGrid.DataSource.DataSet.RecordCount > 0 then
  begin

    if Column.Field = QryItensSelected then
    begin
      QryItens.Edit;
      QryItensSelected.AsBoolean := not QryItensSelected.AsBoolean;
      QryItens.Post;
    end;

    //edtBuscar.SetFocus;
  end;
end;

procedure TformGrid.DBGridDrawColumnCell(Sender: TObject; const Rect: TRect;
  DataCol: Integer; Column: TColumn; State: TGridDrawState);
var
  vLargura : Integer;
begin
  vLargura := 42;
  if DBGrid.DataSource.DataSet.RecordCount > 0 then
  begin
    if (Column.Field = QryItensSelected) then
    begin
      DBGrid.Canvas.FillRect(Rect);
      imageGridSelected.Draw(DBGrid.Canvas, Rect.Left + vLargura, Rect.Top + 3, 0);
      if QryItensSelected.AsBoolean then
        imageGridSelected.Draw(DBGrid.Canvas, Rect.Left + vLargura, Rect.Top + 3, 1)
      else
        imageGridSelected.Draw(DBGrid.Canvas, Rect.Left + vLargura, Rect.Top + 3, 0);
    end;
  end;

end;

procedure TformGrid.FormShow(Sender: TObject);
begin
  QryItens.Close;
  QryItens.Open;
end;

end.
